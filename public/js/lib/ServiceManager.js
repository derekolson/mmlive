// Generated by CoffeeScript 1.6.3
/*
 Maintains socket connection to Node/Socket.io Server
*/


(function() {
  define(['VideoController'], function(VideoController) {
    var ServiceManager;
    ServiceManager = (function() {
      function ServiceManager() {}

      ServiceManager.prototype.connect = function(onConnected) {
        var location;
        this.socket = io.connect('/');
        location = prompt("Enter your location", "Chicago");
        rtc.connect(this.socket, "", location);
        rtc.on('connect', function() {
          var _this = this;
          console.log("WebRTC Connected");
          VideoController.init(location);
          rtc.on('add remote stream', function(stream, id) {
            console.log("Video Stream Connected: " + id);
            return VideoController.addRemoteStream(stream, {
              id: id,
              location: rtc.locations[id],
              mute: false
            });
          });
          rtc.on('disconnect stream', function(id) {
            console.log("Video Stream Disconnected: " + id);
            return VideoController.removeVideo(id);
          });
          return onConnected();
        });
        return this.socket.on('alert', function(data) {
          return VideoController.appView.showAlert(data);
        });
      };

      ServiceManager.prototype.send = function(event, data) {
        console.log("Socket Send Event: " + event);
        return this.socket.emit(event, data);
      };

      return ServiceManager;

    })();
    return new ServiceManager();
  });

}).call(this);
